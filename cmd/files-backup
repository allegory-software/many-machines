#!/bin/bash
# FILES BACKUP ; SRC_DIR BACKUP_DIR [PREV_BACKUP_DIR] ; backup files here
. mmlib

SRC_DIR=$1 BACKUP_DIR=$2 PREV_BACKUP_DIR=$3
checkvars SRC_DIR BACKUP_DIR PREV_BACKUP_DIR?
rel_path      "$BACKUP_DIR" "$PWD0";      BACKUP_DIR=$R1
rel_path "$PREV_BACKUP_DIR" "$PWD0"; PREV_BACKUP_DIR=$R1

_f() {
	must mkdir -p $BACKUP_DIR
	SRC_MACHINE=$MACHINE \
		DST_MACHINE= \
		SRC_DIR=$SRC_DIR \
		DST_DIR=$BACKUP_DIR \
		LINK_DIR=$PREV_BACKUP_DIR \
		PROGRESS=1 rsync_dir
}
NOALL=1 each_md _f
