#!/bin/bash
# UPDATE || prepare a machine for deployments
. mmlib

_f() {

	# we need to install rsync on the machine before we can rsync files to it.
	ssh_script "
		say; apt_install
		say; apt_get_update
		say; apt_get_install \$PACKAGES
	"

	# we need the CA uploaded before we install acme.sh.
	[[ $PACKAGES == *acme* ]] && { say; acme_ca_upload $1; }

	ssh_script_machine "machine_prepare"

	say; mc_conf_upload

	say; say "Machine prepare done."

}
each_machine _f
